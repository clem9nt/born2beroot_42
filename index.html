<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Born2Beroot 42</title>
<meta name="description" content="Born2Beroot is a project that aims to introduce you to the wonderful world of virtualization. #42network">
<meta name="Generator" content="Vim/8.1">
<meta name="plugin-version" content="vim8.1_v1">
<meta name="syntax" content="none">
<meta name="settings" content="use_css,no_foldcolumn,expand_tabs,prevent_copy=">
<meta name="colorscheme" content="nord">
<style type="text/css">
<!--
pre { font-family: monospace; color: #ffffff; background-color: #2e333f; }
body { font-family: monospace; color: #ffffff; background-color: #2e333f; }
* { font-size: 1.1em; }
.notesUrl { color: #ff5faf; text-decoration: underline; font-size: 90%; }
.notesH1 { color: #5fffaf; font-size: 120%; }
.notesListMarker { color: #87ffaf; }
.notesBlockquote { color: #afafff; }
.notesBold { color: #ffd75f; }
.notesItalic { color: #ffffd7; }
.notesTaskTag { color: #87afd7; }
.notesCode { color: #afd7af; }
a { color: hotpink; }
-->
</style>
</head>
<body>
<pre id='vimCodeElement'>
<span class="notesBlockquote">&gt; </span> cvidon@student.42.fr

<span class="notesH1">#       Born2Reboot</span>

<span class="notesH1">#INDEX</span>
------
<span class="notesH1">##  Help</span>
<span class="notesH1">##  Misc</span>
<span class="notesH1">##  Server</span>
<span class="notesH1">###     VM</span>
<span class="notesH1">###     Install</span>
<span class="notesH1">###     Partitioning</span>
<span class="notesH1">###     Comfort</span>
<span class="notesH1">###     Sudoers</span>
<span class="notesH1">###     UFW</span>
<span class="notesH1">###     SSH</span>
<span class="notesH1">###     SSH Connection</span>
<span class="notesH1">###     Password Policy</span>
<span class="notesH1">###     Update Passwords</span>
<span class="notesH1">###     Groups and Users</span>
<span class="notesH1">###     Crontab Monitoring</span>
<span class="notesH1">##  LLMP</span>
<span class="notesH1">###     Lighttpd</span>
<span class="notesH1">###     MariaDB</span>
<span class="notesH1">###     PHP</span>
<span class="notesH1">###     WP</span>
<span class="notesH1">###     IPFS</span>

<span class="notesH1">##  Help</span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">definition</span>
<span class="notesBlockquote">&gt; </span>precision.
&lt;variable_placeholder&gt;
-&gt;<span class="notesCode">Select/Click -able</span>
<span class="notesCode"># root</span>
<span class="notesCode">$ commandline</span>
<span class="notesCode">- remove text</span>
<span class="notesCode">+ insert text</span>
<span class="notesCode">&gt; change text</span>
<span class="notesUrl"><a href="https://www.external_link">https://www.external_link</a></span>

<span class="notesH1">##  Misc</span>

<span class="notesListMarker">*</span> Errors:

Fix the startup error '<span class="notesCode">*ERROR* Failed to send host log message.</span>':
<span class="notesCode">    $ sudo /etc/default/grub</span>
<span class="notesCode">    - GRUB_CMDLINE_LINUX_DEFAULT=&quot;&quot;</span>
<span class="notesCode">    + GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet nomodeset&quot;</span>
<span class="notesCode">    $ sudo update-grub</span>

<span class="notesListMarker">*</span> Services:

List running services:
<span class="notesCode">    $ sudo systemctl status</span>
List services and their status:
<span class="notesCode">    $ sudo service --status-all</span>
List all services status:
<span class="notesCode">    $ sudo systemctl</span>

<span class="notesListMarker">*</span> Misc:

Check updates:
<span class="notesCode">    $ apt update</span>
<span class="notesCode">    $ apt upgrade</span>
<span class="notesCode">    $ apt full-upgrade</span>
<span class="notesCode">    $ apt autoremove</span>
<span class="notesCode">    $ apt autoclean</span>

Network ports usage documentation:
<span class="notesCode">    $ vi /etc/services</span>

Check who is logged in and what they are doing:
<span class="notesCode">    $ w</span>

Cycle console ttys:
<span class="notesCode">    Alt + Left/Right</span>
<span class="notesCode">    Ctrl + Alt + &lt;f1_to_f6&gt;</span>

Change hostname:
<span class="notesCode">    $ sudo hostnamectl set-hostname &lt;new_name&gt;</span>
<span class="notesCode">    $ sudo vi /etc/hosts</span>
<span class="notesCode">    &gt; 127.0.1.1   &lt;new_name&gt;</span>
<span class="notesCode">    $ sudo reboot</span>
Check hostname:
<span class="notesCode">    $ hostnamectl</span>

<span class="notesH1">##  Server</span>

<span class="notesH1">###     VM</span>

Download VirtualBox
Download Debian latest stable release:
<span class="notesUrl"><a href="https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/">https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/</a></span>

 VirtualBox -&gt;<span class="notesCode">New</span>
 Name: <span class="notesCode">debian-server</span>
 Machine Folder: <span class="notesCode">somewhere</span>
 Version: <span class="notesCode">Debian (64-bit)</span>
 -&gt;<span class="notesCode">Continue</span>
<span class="notesCode">    1024 MB</span>
 -&gt;<span class="notesCode">Continue</span>
<span class="notesCode">    8 GB</span>
<span class="notesCode">    VDI (VirtualBox Disk Image)</span>
<span class="notesCode">    Dynamically allocated</span>
 -&gt;<span class="notesCode">Create</span>

 VirtualBox -&gt;<span class="notesCode">Settings</span> -&gt;<span class="notesCode">Storage</span>
 <span class="notesCode">Controller: IDE</span> -&gt;ðŸ’¿ <span class="notesCode">Empty</span>
 <span class="notesCode">Optical Drive:</span> -&gt;ðŸ’¿
<span class="notesCode">    debian-11.1.0-amd64-netinst.iso</span>
 -&gt;<span class="notesCode">OK</span>

 VirtualBox -&gt;<span class="notesCode">Start</span>

Be able to use CMD-TAB switch between host and VM windows:
 VirtualBox -&gt;<span class="notesCode">Input</span> -&gt;<span class="notesCode">Keyboard/Keyboard Settings</span>
 <span class="notesCode">Auto Capture Keyboard</span> <span class="notesCode">OFF</span>

Screen size:
 VirtualBox -&gt;<span class="notesCode">View</span> -&gt;<span class="notesCode">Virtual Screen</span>: 200%

<span class="notesH1">###     Install</span>

 -&gt;<span class="notesCode">Install</span>
 Hostname: <span class="notesCode">cvidon42</span>
 Domain name:
 Root password: <span class="notesCode">toor</span>
 Full name for the new user: <span class="notesCode">clement</span>
 Username for your account: <span class="notesCode">cvidon</span>
 Choose a password for the new user: <span class="notesCode">resu</span>
 Select your time zone: <span class="notesCode">Central</span>

<span class="notesH1">###     Partitioning</span>

-----[<span class="notesTaskTag">MANDATORY</span>]-----

 Partitioning method: <span class="notesCode">â€¦encrypted LVM</span>
 Partitioning scheme: <span class="notesCode">Separate /home partition</span>
 Encryption passphrase: <span class="notesCode">ksid</span>
 Amount of volume group to use for guided partitioning: <span class="notesCode">max</span>
 Finish partitioning:
 -&gt;<span class="notesCode">#1</span> -&gt;<span class="notesCode">4.0 GB</span> -&gt;<span class="notesCode">ext4 /home</span>
 -&gt;<span class="notesCode">#2</span> -&gt;<span class="notesCode">3.0 GB</span> -&gt;<span class="notesCode">ext4 /</span>
 -&gt;<span class="notesCode">#3</span> -&gt;<span class="notesCode">1.0 GB</span> -&gt;<span class="notesCode">swap swap</span>

-----[<span class="notesTaskTag">BONUS</span>]------

Partitioning method: <span class="notesCode">Manual</span>
 -&gt;<span class="notesCode">SCSI1 (0,0,0) (sda) - 8.6 GB ATA VBOX HARDDISK</span>

Create <span class="notesCode">/boot</span> <span class="notesItalic">primary partition</span>:
<span class="notesBlockquote">&gt; </span>Bootable partition that it contains the operating system.
 -&gt;<span class="notesCode">FREE SPACE</span> -&gt;<span class="notesCode">Create a new partition</span>
 New partition size: <span class="notesCode">500M</span>
 -&gt;<span class="notesCode">Primary</span> -&gt;<span class="notesCode">Beginning</span>
 Mount point: <span class="notesCode">/boot</span>
 -&gt;<span class="notesCode">Done setting up the partition</span>

Set the rest as <span class="notesItalic">logical partition</span>:
<span class="notesBlockquote">&gt; </span>Portion of a computer's hardware that is set aside and virtualised
<span class="notesBlockquote">&gt; </span>as an additional computer.
 -&gt;<span class="notesCode">FREE SPACE</span> -&gt;<span class="notesCode">Create a new partition</span>
 New partition size: <span class="notesCode">max</span> -&gt;<span class="notesCode">Logical</span> -&gt;<span class="notesCode">Beginning</span>
 Mount point: <span class="notesCode">Do not mount it</span> -&gt;<span class="notesCode">Done setting up the partition</span>

Encrypt it:
 -&gt;<span class="notesCode">Configure encrypted volumes</span> -&gt;<span class="notesCode">Create encrypted volumes</span>
 -&gt; 2nd partition (the bigger one) -&gt;<span class="notesCode">Done setting up the partition</span>
 -&gt;<span class="notesCode">Finish</span>
 Encryption passphrase: <span class="notesCode">ksid</span>

Create the logical partitions:
 -&gt;<span class="notesCode">Configure the Logical Volume Manager</span> -&gt;<span class="notesCode">Create volume group</span>
 Volume group name: <span class="notesCode">LVMGroup</span>
 -&gt; 1st partition (the bigger one) -&gt;<span class="notesCode">Done setting up the partition</span>

 -&gt;<span class="notesCode">Create logical volume</span> -&gt;<span class="notesCode">LVMGroup</span>
 Logical volume name: <span class="notesCode">root</span>
 Logical volume size: <span class="notesCode">2G</span>

 -&gt;<span class="notesCode">Create logical volume</span> -&gt;<span class="notesCode">LVMGroup</span>
 Logical volume name: <span class="notesCode">swap</span>
 Logical volume size: <span class="notesCode">1024M</span>

 -&gt;<span class="notesCode">Create logical volume</span> -&gt;<span class="notesCode">LVMGroup</span>
 Logical volume name: <span class="notesCode">home</span>
 Logical volume size: <span class="notesCode">1G</span>

 -&gt;<span class="notesCode">Create logical volume</span> -&gt;<span class="notesCode">LVMGroup</span>
 Logical volume name: <span class="notesCode">var</span>
 Logical volume size: <span class="notesCode">1G</span>

 -&gt;<span class="notesCode">Create logical volume</span> -&gt;<span class="notesCode">LVMGroup</span>
 Logical volume name: <span class="notesCode">srv</span>
 Logical volume size: <span class="notesCode">1G</span>

 -&gt;<span class="notesCode">Create logical volume</span> -&gt;<span class="notesCode">LVMGroup</span>
 Logical volume name: <span class="notesCode">tmp</span>
 Logical volume size: <span class="notesCode">1G</span>

 -&gt;<span class="notesCode">Create logical volume</span> -&gt;<span class="notesCode">LVMGroup</span>
 Logical volume name: <span class="notesCode">var-log</span>
 Logical volume size: <span class="notesCode">1056MB</span>

 -&gt;<span class="notesCode">Finish</span>

 -&gt;<span class="notesCode">#1</span> -&gt;<span class="notesCode">Use as:â€¦</span> -&gt;<span class="notesCode">Ext4</span> -&gt;<span class="notesCode">Mount point</span> -&gt;<span class="notesCode">home</span>
 -&gt;<span class="notesCode">#1</span> -&gt;<span class="notesCode">Use as:â€¦</span> -&gt;<span class="notesCode">Ext4</span> -&gt;<span class="notesCode">Mount point</span> -&gt;<span class="notesCode">/</span>
 -&gt;<span class="notesCode">#1</span> -&gt;<span class="notesCode">Use as:â€¦</span> -&gt;<span class="notesCode">Ext4</span> -&gt;<span class="notesCode">Mount point</span> -&gt;<span class="notesCode">srv</span>
 -&gt;<span class="notesCode">#1</span> -&gt;<span class="notesCode">Use as:â€¦</span> -&gt;<span class="notesCode">swap</span> -&gt;<span class="notesCode">Mount point</span> -&gt;<span class="notesCode">swap</span>
 -&gt;<span class="notesCode">#1</span> -&gt;<span class="notesCode">Use as:â€¦</span> -&gt;<span class="notesCode">Ext4</span> -&gt;<span class="notesCode">Mount point</span> -&gt;<span class="notesCode">tmp</span>
 -&gt;<span class="notesCode">#1</span> -&gt;<span class="notesCode">Use as:â€¦</span> -&gt;<span class="notesCode">Ext4</span> -&gt;<span class="notesCode">Mount point</span> -&gt;<span class="notesCode">var</span>
 -&gt;<span class="notesCode">#1</span> -&gt;<span class="notesCode">Use as:â€¦</span> -&gt;<span class="notesCode">Ext4</span> -&gt;<span class="notesCode">Mounâ€¦</span> -&gt;<span class="notesCode">Enter Manually</span>-&gt;<span class="notesCode">/var/log</span>

 -&gt;<span class="notesCode">Finishâ€¦</span>

------------------

 Scan extra installation media: <span class="notesCode">No</span>
 Choose software to install: uncheck all
 Device for boot loader installation: <span class="notesCode">/dev/sda â€¦</span>

Log in as 'root'.
Check partitioning:
<span class="notesCode">    # lsblk</span>

<span class="notesListMarker">*</span> Partitions and hard disks:
<span class="notesBlockquote">&gt; </span><span class="notesBold">/dev/hda</span> is the 'master <span class="notesItalic">IDE</span>' (Integrated Drive Electronics)
<span class="notesBlockquote">&gt; </span>drive on the primary 'IDE controller'. Partitions of this disk are
<span class="notesBlockquote">&gt; </span>named hda1, hda2. A 'second IDE' device would be named hdb.  (The
<span class="notesBlockquote">&gt; </span>motherboard has two IDE connectors on which we plug the cables which
<span class="notesBlockquote">&gt; </span>can each accommodate 2 peripherals.
<span class="notesCode">    IDE connector 0 -&gt; master: /dev/hda -&gt; slave: /dev/hdb</span>
<span class="notesCode">    IDE connector 1 -&gt; master: /dev/hdc -&gt; slave: /dev/hdd</span>
<span class="notesBlockquote">&gt; </span>'hda1' to 'hda4' will be <span class="notesBold">primary</span> partitions.
<span class="notesBlockquote">&gt; </span>'hda5' to 'hdaâ€¦' will be <span class="notesBold">logical</span> partitions (of an extended partition).
<span class="notesBlockquote">&gt; </span>An <span class="notesBold">extended</span> partition is a primary partition which itself
<span class="notesBlockquote">&gt; </span>contains another partition table.
<span class="notesUrl"><a href="http://stephane.boireau.free.fr/informatique/samba/samba/partitions_et_disques_durs.htm">http://stephane.boireau.free.fr/informatique/samba/samba/partitions_et_disques_durs.htm</a></span>

<span class="notesBlockquote">&gt; </span><span class="notesItalic">SCSI</span> disks (Small Computer System Interface) will be same as above
<span class="notesBlockquote">&gt; </span>with a 's' <span class="notesBold">dev/sda</span>.
<span class="notesBlockquote">&gt; </span>The '/dev' contains all the peripherals (devices).

<span class="notesH1">###     Comfort</span>

Login as root.

Set time:
<span class="notesCode">    # dpkg-reconfigure tzdata</span>
Font size:
<span class="notesCode">    # dpkg-reconfigure console-setup</span>
Caps lock to Ctrl:
<span class="notesCode">    # vi /etc/default/keyboard</span>
<span class="notesCode">    - XKBOPTIONS=&quot;&quot;</span>
<span class="notesCode">    + XKBOPTIONS=&quot;ctrl:nocaps&quot;</span>
Apply now:
<span class="notesCode">    # setupcon</span>
Survive reboot:
<span class="notesCode">    # dpkg-reconfigure keyboard-configuration</span>

Check updates:
<span class="notesCode">    # apt update</span>
Install most useful packages:
<span class="notesCode">    # apt install zsh vim tmux</span>
<span class="notesCode">    # apt install git wget curl</span>
<span class="notesCode">    # apt install man-db manpages-dev</span>
<span class="notesCode">    # apt install sudo</span>

Set default editor:
<span class="notesCode">    # update-alternatives --set editor /usr/bin/vim.basic</span>

Add 'cvidon' to 'sudo' group:
<span class="notesCode">    # usermod -aG sudo cvidon</span>
<span class="notesCode">    # groups cvidon</span>
Login as 'cvidon':
<span class="notesCode">    # su - cvidon</span>

Change default Shell:
<span class="notesCode">    $ chsh -s /bin/zsh</span>
<span class="notesCode">    $ zsh</span>
<span class="notesCode">    $ zsh</span>
<span class="notesBlockquote">&gt; </span>And (q).

Import mini-conf:
<span class="notesCode">    $ mkdir ~/Documents</span>
<span class="notesCode">    $ cd !$</span>
<span class="notesCode">    $ git clone </span><span class="notesUrl"><a href="https://github.com/clem9nt/mini-conf">https://github.com/clem9nt/mini-conf</a></span>
<span class="notesCode">    $ bash mini-conf/installer.sh</span>
<span class="notesCode">    $ source ~/.zshrc</span>

<span class="notesH1">###     Sudoers</span>

Configure 'sudoers' group via 'mysudoers':
<span class="notesCode">    $ sudo visudo -f /etc/sudoers.d/mysudoers</span>
<span class="notesCode">    + Defaults  secure_path=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin&quot;</span>
<span class="notesCode">    + Defaults  passwd_tries=3</span>
<span class="notesCode">    + Defaults  badpass_message=&quot;Wrong password.  This incident will be reported.&quot;</span>
<span class="notesCode">    + Defaults  iolog_dir=/var/log/sudo/%{user}</span>
<span class="notesCode">    + Defaults  log_input,log_output</span>
<span class="notesCode">    + Defaults  requiretty</span>

<span class="notesBlockquote">&gt; </span>Writing to <span class="notesBold">sudoers.d/mysudoers</span> instead of 'sudoers' is safer
<span class="notesBlockquote">&gt; </span>because 'sudoers' is under control of the distribution package
<span class="notesBlockquote">&gt; </span>manager and an upgrade could overwrite it.

<span class="notesBlockquote">&gt; </span><span class="notesBold">secure_path</span> prevent any script to be executed with sudo unless
<span class="notesBlockquote">&gt; </span>it matches the secure path.
<span class="notesBlockquote">&gt; </span><span class="notesBold">requiretty</span> prevents sudo from being used from daemons or
<span class="notesBlockquote">&gt; </span>other detached processes (cronjobs, web server plugins).

<span class="notesH1">###     UFW</span>

Install package:
<span class="notesCode">    $ sudo apt update</span>
<span class="notesCode">    $ sudo apt install ufw</span>
Enable UFW:
<span class="notesCode">    $ sudo ufw enable</span>

<span class="notesBlockquote">&gt; </span>UFW unit status is shown as <span class="notesItalic">active (exited)</span> because it is a 'oneshot
<span class="notesBlockquote">&gt; </span>service'. <span class="notesBold">Oneshot services</span> are expected to take action and exit
<span class="notesBlockquote">&gt; </span>immediately, thus they are not really services, no running processes
<span class="notesBlockquote">&gt; </span>remain.

Disable UFW dupplicate logging /var/log/{kern.log,syslog} and reduce
it to /var/log/ufw.log:
<span class="notesCode">    $ sudo vi /etc/rsyslog.d/20-ufw.conf</span>
<span class="notesCode">    &gt; &amp; stop</span>

<span class="notesH1">###     SSH</span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">SSH</span> (Secure Shell or Secure Socket Shell), allows to securely
<span class="notesBlockquote">&gt; </span>connect to a remote computer or a server by using a text based
<span class="notesBlockquote">&gt; </span>interface. <span class="notesBold">OpenSSH</span> is an open source implementation of the
<span class="notesBlockquote">&gt; </span>protocol, it works with a client (SSH) and a server (sshd).

Install package:
<span class="notesCode">    $ sudo apt update</span>
<span class="notesCode">    $ sudo apt install openssh-server</span>
Check that SSH is active and enabled:
<span class="notesCode">    $ sudo service ssh status</span>

Change default port:
<span class="notesCode">    $ sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak</span>
<span class="notesCode">    $ sudo vi /etc/ssh/sshd_config</span>
<span class="notesCode">    &gt; Port 4242</span>
<span class="notesCode">    &gt; PermitRootLogin no</span>

Set a firewall exceptions to port 4242:
<span class="notesCode">    $ sudo ufw allow 4242/tcp</span>
Check firewall exceptions:
<span class="notesCode">    $ sudo ufw status</span>

Restart the service:
<span class="notesCode">    $ sudo service ssh restart</span>

<span class="notesH1">###     SSH Connection</span>

Port forwarding:
MyVM -&gt;<span class="notesCode">Settings</span> -&gt;<span class="notesCode">Network</span>
 Attached to: <span class="notesCode">NAT</span>
 -&gt;<span class="notesCode">Advanced</span> -&gt;<span class="notesCode">Port Forwarding</span>
 -&gt;(+) Name:<span class="notesCode">SSH</span>| Host Port:<span class="notesCode">4242</span>| Guest Port:<span class="notesCode">4242</span>

Check port 4242 tcp connection:
<span class="notesCode">    $ sudo ss -nat | grep 4242</span>

Connect to guest from host:
<span class="notesCode">    $ ssh -p 4242 cvidon@127.0.0.1</span>

<span class="notesBlockquote">&gt; </span>A good practice is to disable password and only allow connections
<span class="notesBlockquote">&gt; </span>that come with a trusted public key.

SFTP (Secure File Transfer Protocol):

Connect to guest from host:
<span class="notesCode">    $ sftp -P 4242 cvidon@127.0.0.1</span>
Put, get, rm a file:
<span class="notesCode">    sftp&gt; put &lt;file&gt;</span>
<span class="notesCode">    sftp&gt; get &lt;file&gt;</span>
<span class="notesCode">    sftp&gt; rm  &lt;file&gt;</span>

<span class="notesH1">###     Password Policy</span>

Install package:
<span class="notesCode">    $ sudo apt install libpam-pwquality</span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">pam_pwquality</span> provides common functions for password quality
<span class="notesBlockquote">&gt; </span>checking, scoring them on their apparent randomness.

Configure password policy:
<span class="notesCode">    $ sudo cp /etc/pam.d/common-password /etc/pam.d/common-password.bak</span>
<span class="notesCode">    $ sudo vi /etc/pam.d/common-password</span>

At the end of the line matching 'requisite  pam_pwquality.so' after
'retry=3' and space separated, add:
<span class="notesCode">    &gt; minlen=10</span>
<span class="notesCode">      ocredit=-1 lcredit=-1 ucredit=-1 dcredit=-1</span>
<span class="notesCode">      maxrepeat=3</span>
<span class="notesCode">      reject_username</span>
<span class="notesCode">      difok=7</span>
<span class="notesCode">      enforce_for_root</span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">Strong password policy</span>:
<span class="notesBlockquote">&gt; </span>- 10 chars long minimum.
<span class="notesBlockquote">&gt; </span>- At least 1 special char, 1 lower case, 1 upper case, 1 number.
<span class="notesBlockquote">&gt; </span>- Not more than 3 consecutive identical chars.
<span class="notesBlockquote">&gt; </span>- Doesn't include username.
<span class="notesBlockquote">&gt; </span>- Doesn't include more than 7 chars from the former password
<span class="notesBlockquote">&gt; </span>(can't apply to root because its former password aren't preserved)
<span class="notesBlockquote">&gt; </span>- Previous rules apply to all users and root.

Configure password expiration:
<span class="notesCode">    $ sudo cp /etc/login.defs /etc/login.defs.bak</span>
<span class="notesCode">    $ sudo vi /etc/login.defs</span>
<span class="notesCode">    &gt; PASS_MAX_DAYS 30</span>
<span class="notesCode">    &gt; PASS_MIN_DAYS 2</span>
<span class="notesCode">    &gt; PASS_WARN_AGE 7</span>
<span class="notesBlockquote">&gt; </span>Expire every 30 days.
<span class="notesBlockquote">&gt; </span>At least 2 days between two password modifications.
<span class="notesBlockquote">&gt; </span>Notify 7 days before a password expiration.

Apply this parameters to existing users:
PASS_MIN_DAYS 2:
<span class="notesCode">    $ sudo chage --mindays 2 &lt;user&gt;</span>
PASS_MAX_DAYS 30:
<span class="notesCode">    $ sudo chage --maxday 30 &lt;user&gt;</span>
PASS_WARN_AGE 7:
<span class="notesCode">    $ sudo chage --warndays 7 &lt;user&gt;</span>

Check password policy:
<span class="notesCode">    $ chage -l &lt;user&gt;</span>

<span class="notesH1">###     Update Passwords</span>

Change LUKS passphrase:
Find UUID of the drive:
<span class="notesCode">    $ cat /etc/crypttab</span>
Find ID of the drive:
<span class="notesCode">    $ sudo blkid | grep &lt;some_UUID_chars&gt; | cut -d : -f 1</span>
Add a passphrase:
<span class="notesCode">    $ sudo cryptsetup luksAddKey &lt;ID&gt;</span>
Remove a passphrase:
<span class="notesCode">    $ sudo cryptsetup luksRemoveKey &lt;ID&gt;</span>
<span class="notesBlockquote">&gt; </span>Be <span class="notesItalic">careful</span> to keep at least one passphrase before removing the
<span class="notesBlockquote">&gt; </span>last one.

<span class="notesBlockquote">&gt; </span><span class="notesBold">LUKS</span> (Linux Unified Key Setup) is a disk encryption standard.

Change users password:
<span class="notesCode">    $ sudo passwd &lt;user&gt;</span>

<span class="notesH1">###     Groups and Users</span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">$ usermod</span> modifies or changes any attributes of an 'already
<span class="notesBlockquote">&gt; </span>existing' user.  (unlike <span class="notesCode">adduser</span> used to 'create' an user account)
<span class="notesBlockquote">&gt; </span><span class="notesCode">-G</span> specifies the list of supplementary groups,<span class="notesCode">-a</span> to 'append'
<span class="notesBlockquote">&gt; </span>instead of 'replaces' the user's group with the supplementary ones.

<span class="notesBlockquote">&gt; </span><span class="notesBold">$ getent</span> get a databases text file entries (ie. <span class="notesCode">group</span>
<span class="notesBlockquote">&gt; </span>database's entries for <span class="notesCode">user</span> and <span class="notesCode">sudo</span>).

List users:
<span class="notesCode">    $ cut -d: -f1 /etc/passwd</span>

Create 'user42' group:
<span class="notesCode">    $ sudo groupadd user42</span>
Check group creation:
<span class="notesCode">    $ sudo getent group user42</span>

Set a 'clem' to a 'user42':
<span class="notesCode">    $ sudo usermod -aG user42 clem</span>
Check clem's groups:
<span class="notesCode">    $ sudo groups clem</span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">/etc/passwd</span> columns:
<span class="notesBlockquote">&gt; </span><span class="notesCode">username:password:uid:gid:comment:home_directory:shell_used</span>
<span class="notesBlockquote">&gt; </span>An 'x' in the password column means that the password is encrypted
<span class="notesBlockquote">&gt; </span>and to be found in '/etc/shadow'.

Delete &lt;group&gt;:
<span class="notesCode">    $ delgroup &lt;group&gt;</span>
Delete &lt;user&gt; (and all its files):
<span class="notesCode">    $ deluser --remove-all-files &lt;user&gt;</span>

<span class="notesH1">###     Crontab Monitoring</span>

Install package:
<span class="notesCode">    $ sudo apt update</span>
<span class="notesCode">    $ sudo apt install net-tools</span>

Create 'monitoring.sh':
<span class="notesCode">    $ sudo vi /usr/local/sbin/monitoring.sh</span>
<span class="notesCode">    + #!/bin/bash</span>
<span class="notesCode">    + arc=$(uname -a)</span>
<span class="notesCode">    + pcpu=$(grep &quot;physical id&quot; /proc/cpuinfo | sort | uniq | wc -l)</span>
<span class="notesCode">    + vcpu=$(grep &quot;^processor&quot; /proc/cpuinfo | wc -l)</span>
<span class="notesCode">    + fram=$(free -m | grep Mem: | awk '{print $2}')</span>
<span class="notesCode">    + uram=$(free -m | grep Mem: | awk '{print $3}')</span>
<span class="notesCode">    + pram=$(free    | grep Mem: | awk '{printf(&quot;%.2f&quot;), $3/$2*100}')</span>
<span class="notesCode">    + fdisk=$(df -Bg | grep '^/dev/' | grep -v '/boot$' | awk '{ft += $2} END {print ft}')</span>
<span class="notesCode">    + udisk=$(df -Bm | grep '^/dev/' | grep -v '/boot$' | awk '{ut += $3} END {print ut}')</span>
<span class="notesCode">    + pdisk=$(df -Bm | grep '^/dev/' | grep -v '/boot$' | awk '{ut += $3} {ft+= $2} END {printf(&quot;%d&quot;), ut/ft*100}')</span>
<span class="notesCode">    + cpul=$(top -bn1 | grep '^%Cpu' | cut -c 9- | xargs | awk '{printf(&quot;%.1f%%&quot;), $1 + $3}')</span>
<span class="notesCode">    + lb=$(who -b | awk '$1 == &quot;system&quot; {print $3 &quot; &quot; $4}')</span>
<span class="notesCode">    + lvmt=$(lsblk -o TYPE | grep &quot;lvm&quot; | wc -l)</span>
<span class="notesCode">    + lvmu=$(if [ $lvmt -eq 0 ]; then echo no; else echo yes; fi)</span>
<span class="notesCode">    +</span>
<span class="notesCode">    + # net-tools required:</span>
<span class="notesCode">    + ctcp=$(cat /proc/net/tcp | wc -l | awk '{print $1-1}' | tr '' ' ')</span>
<span class="notesCode">    + ulog=$(users | wc -w)</span>
<span class="notesCode">    + ip=$(hostname -I)</span>
<span class="notesCode">    + mac=$(ip link show | awk '$1 == &quot;link/ether&quot; {print $2}')</span>
<span class="notesCode">    +</span>
<span class="notesCode">    + # journalctl can run because the script exec from sudo cron</span>
<span class="notesCode">    + cmds=$(journalctl _COMM=sudo | grep COMMAND | wc -l)</span>
<span class="notesCode">    +</span>
<span class="notesCode">    + echo &quot;  #Architecture: $arc</span>
<span class="notesCode">    +     $ sudoCPU physical: $pcpu</span>
<span class="notesCode">    +     $ sudovCPU: $vcpu</span>
<span class="notesCode">    +     $ sudoMemory Usage: $uram/${fram}MB ($pram%)</span>
<span class="notesCode">    +     $ sudoDisk Usage: $udisk/${fdisk}Gb ($pdisk%)</span>
<span class="notesCode">    +     $ sudoCPU load: $cpul</span>
<span class="notesCode">    +     $ sudoLast boot: $lb</span>
<span class="notesCode">    +     $ sudoLVM use: $lvmu</span>
<span class="notesCode">    +     $ sudoConnexions TCP : $ctcp ESTABLISHED</span>
<span class="notesCode">    +     $ sudoUser log: $ulog</span>
<span class="notesCode">    +     $ sudoNetwork: IP $ip ($mac)</span>
<span class="notesCode">    +     $ sudoSudo: $cmds cmd&quot;</span>

Check script output:
<span class="notesCode">    $ bash /usr/local/sbin/monitoring.sh</span>
Configure a root cronjob that run the script every 10min:
<span class="notesCode">    $ sudo crontab -u root -e</span>
<span class="notesCode">    + */10 * * * * bash /usr/local/sbin/monitoring.sh | wall</span>
<span class="notesUrl"><a href="https://crontab.guru/#*/10_*_*_*_*/">https://crontab.guru/#*/10_*_*_*_*/</a></span>

Configure a cronjob:
Check service status:
<span class="notesCode">    $ sudo systemctl status cron</span>
Check script executions:
<span class="notesCode">    $ sudo grep -a &quot;monitoring.sh&quot; /var/log/syslog</span>

<span class="notesH1">##  LLMP</span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">LLMP Stack</span>: Linux Lighttpd MySQL and PHP.

<span class="notesH1">###     Lighttpd</span>

Install package:
<span class="notesCode">    $ sudo apt install lighttpd</span>
Check that Lighty is active and enabled:
<span class="notesCode">    $ sudo systemctl status lighttpd</span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">Lighttpd</span> (pronounced lighty) is a fast, secure, flexible and
<span class="notesBlockquote">&gt; </span>open source web server optimized for high performance environments.
<span class="notesBlockquote">&gt; </span>Suited to handle loads of traffic with minimal memory consumption.

Set a firewall exceptions to port 80:
<span class="notesCode">    $ sudo ufw allow 80/tcp</span>
Check firewall exceptions:
<span class="notesCode">    $ sudo ufw status</span>

Check Lighttpd welcome page from the host web browser:

Port forwarding:
MyVM -&gt;<span class="notesCode">Settings</span> -&gt;<span class="notesCode">Network</span>
 Attached to: <span class="notesCode">NAT</span>
 -&gt;<span class="notesCode">Advanced</span> -&gt;<span class="notesCode">Port Forwarding</span>
 -&gt;(+) Name:<span class="notesCode">WWW</span>| Host Port:<span class="notesCode">80</span>| Guest Port:<span class="notesCode">80</span>

Check that port 80 is open:
<span class="notesCode">    $ sudo ss -nat | grep 80</span>

Visit Lighttpd welcome page at the address 127.0.0.1
from the host web browser.

<span class="notesH1">###     MariaDB</span>

Install package:
<span class="notesCode">    $ sudo apt install mariadb-server</span>
Check that MariaDB is active and enabled:
<span class="notesCode">    $ sudo systemctl status mariadb</span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">MariaDB</span> is a DBMS (Relational Database Management System) that
<span class="notesBlockquote">&gt; </span>is a fork and an alternative to MySQL (that uses some proprietary
<span class="notesBlockquote">&gt; </span>code).  <span class="notesUrl"><a href="https://kinsta.com/blog/mariadb-vs-mysql/">https://kinsta.com/blog/mariadb-vs-mysql/</a></span>

Configure MariaDB security settings:
<span class="notesCode">    $ sudo mysql_secure_installation</span>
 Enter current password for root (enter for none): <span class="notesCode">enter</span>
 Switch to unix_socket authentication? <span class="notesCode">n</span>
<span class="notesBlockquote">&gt; </span>'unix_socket' auth. plugin is a passwordless security mechanism.
 Set root password? <span class="notesCode">n</span>
 Remove anonymous users? <span class="notesCode">Y</span>
 Disallow root login remotely? <span class="notesCode">Y</span>
 Remove test database and access to it? <span class="notesCode">Y</span>
 Reload privilege tables now? <span class="notesCode">Y</span>

Log in to MariaDB console:
<span class="notesCode">    $ sudo mysql</span>
<span class="notesBlockquote">&gt; </span>Same as '<span class="notesCode">$ sudo mariadb</span>'.

Create 'clem-db' new database:
<span class="notesCode">    mysql&gt; CREATE DATABASE clem_db;</span>

Create 'clem' database user identified by 'melc' password:
<span class="notesCode">    mysql&gt; CREATE USER clem@localhost IDENTIFIED BY 'melc';</span>
Give full privileges on 'clem_db' to 'clem':
<span class="notesCode">    mysql&gt; GRANT ALL ON clem_db.* TO clem@localhost WITH GRANT OPTION;</span>

Makes those changes take effect (without reload/restart MariaDB):
<span class="notesCode">    mysql&gt; FLUSH PRIVILEGES;</span>

Check all users and host name where they are allowed to login:
<span class="notesCode">    mysql&gt; SELECT host, user FROM mysql.user;</span>
Exit MariaDB shell: <span class="notesCode">exit</span>

Log into MariaDB server with the new user:
<span class="notesCode">    $ sudo mysql -u clem -p</span>

Check which databases user has access to:
<span class="notesCode">    mysql&gt; SHOW DATABASES;</span>
Exit MariaDB shell: <span class="notesCode">exit</span>

<span class="notesH1">###     PHP</span>

Install packages:
<span class="notesCode">    $ sudo apt install php-cgi php-mysql</span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">php-mysql</span> package provides SQL modules for PHP.

<span class="notesBlockquote">&gt; </span><span class="notesBold">CGI</span> (Common Gateway Interface) is a protocol used by most Web
<span class="notesBlockquote">&gt; </span>servers to capture and communicate session information to and from
<span class="notesBlockquote">&gt; </span>server-side processes. It <span class="notesItalic">connects the front and the back</span> end to
<span class="notesBlockquote">&gt; </span>make web pages dynamic and interactive.
<span class="notesUrl"><a href="http://www.uvm.edu/~hag/naweb96/zshoecraft.html">http://www.uvm.edu/~hag/naweb96/zshoecraft.html</a></span>

<span class="notesBlockquote">&gt; </span><span class="notesBold">PHP CGI</span> is the legacy way of running applications, it goes with very
<span class="notesBlockquote">&gt; </span><span class="notesItalic">poor performance</span> for busier websites: each time we load a page,
<span class="notesBlockquote">&gt; </span>PHP needs read php.ini, set its settings, loads all its extensions,
<span class="notesBlockquote">&gt; </span>and finally start work parsing the script.
<span class="notesBlockquote">&gt; </span>- One key <span class="notesItalic">advantage</span> to using the CGI version is that PHP reads its
<span class="notesBlockquote">&gt; </span>  settings every time you load a page.  With PHP running as a module,
<span class="notesBlockquote">&gt; </span>  any changes you make in the php.ini file do not kick in until we
<span class="notesBlockquote">&gt; </span>  restart our web server, so the CGI version is preferable if we <span class="notesItalic">testing</span>
<span class="notesBlockquote">&gt; </span>  new settings and want to see instant responses.
<span class="notesBlockquote">&gt; </span>- Another <span class="notesItalic">benefit</span> of CGI is that it keeps the code execution
<span class="notesBlockquote">&gt; </span>  separate from the web server, increasing the <span class="notesItalic">security</span>.

<span class="notesBlockquote">&gt; </span><span class="notesBold">PHP-FPM</span> (FastCGI Process Manager) is an alternative that allows
<span class="notesBlockquote">&gt; </span>a website to handle strenuous loads. <span class="notesItalic">Modern, optimized, robust</span> for
<span class="notesBlockquote">&gt; </span>busier websites and low resources consumption but <span class="notesItalic">lower security</span>
<span class="notesBlockquote">&gt; </span>than CGI and require more <span class="notesItalic">complicated configuration</span> than CGI.
<span class="notesUrl"><a href="https://www.basezap.com/difference-php-cgi-php-fpm/">https://www.basezap.com/difference-php-cgi-php-fpm/</a></span>

Enable FastCGI Lighttpd modules:
<span class="notesCode">    $ sudo lighty-enable-mod fastcgi</span>
<span class="notesCode">    $ sudo lighty-enable-mod fastcgi-php</span>
Restart server:
<span class="notesCode">    $ sudo service lighttpd force-reload</span>

<span class="notesH1">###     WP</span>

Download WP to /var/www/html:
<span class="notesCode">    $ sudo wget </span><span class="notesUrl"><a href="http://wordpress.org/latest.tar.gz">http://wordpress.org/latest.tar.gz</a></span>
Extract and install content:
<span class="notesCode">    $ sudo tar xzvf latest.tar.gz</span>
<span class="notesCode">    $ sudo cp -r wordpress/* /var/www/html</span>
Cleanup:
<span class="notesCode">    $ sudo rm -rf latest.tar.gz wordpress</span>

Reference 'clem_db' and 'clem' into WP config:
<span class="notesCode">    $ sudo cp /var/www/html/wp-config-sample.php /var/www/html/wp-config.php</span>
<span class="notesCode">    $ sudo vi /var/www/html/wp-config.php</span>
<span class="notesCode">    &gt; define( 'DB_NAME', 'clem_db' );</span>
<span class="notesCode">    &gt; define( 'DB_USER', 'clem' );</span>
<span class="notesCode">    &gt; define( 'DB_PASSWORD', 'melc' );</span>

Visit localhost from the host web browser to see the WP default page.

<span class="notesH1">###     IPFS</span>

Download GO:
<span class="notesCode">    $ curl -O </span><span class="notesUrl"><a href="https://dl.google.com/go/go1.17.5.linux-amd64.tar.gz">https://dl.google.com/go/go1.17.5.linux-amd64.tar.gz</a></span>
Check the hash:
<span class="notesCode">    $ sha256sum go1.17.5.linux-amd64.tar.gz</span>
<span class="notesCode">    </span><span class="notesUrl"><a href="https://go.dev/dl/">https://go.dev/dl/</a></span>

Install:
<span class="notesCode">    $ sudo tar -C /usr/local -xzf go1.17.5.linux-amd64.tar.gz</span>

Update zsh env:
<span class="notesCode">    $ echo 'export PATH=$PATH:/usr/local/go/bin' | sudo tee -a ~/.zprofile</span>
<span class="notesCode">    $ echo 'export GOPATH=&quot;$HOME/go&quot;' | sudo tee -a ~/.zprofile</span>
<span class="notesCode">    $ echo 'PATH=&quot;$GOPATH/bin:$PATH&quot;' | sudo tee -a ~/.zprofile</span>
Source zprofile:
<span class="notesCode">    $ source ~/.zprofile</span>

Check installation:
<span class="notesCode">    $ go version</span>

Download IPFS:
<span class="notesCode">    $ go install github.com/ipfs/ipfs-update@latest</span>
Check updates:
<span class="notesCode">    $ ipfs-update versions</span>
Update to the latest version:
<span class="notesCode">    $ ipfs-update install v?.??.?</span>

Increase maximum buffer size (from 300k to to 2500k):
<span class="notesCode">    $ sudo sysctl -w net.core.rmem_max=2500000</span>
Initialize IPFS:
<span class="notesCode">    $ ipfs init --profile server</span>

Change IPFS repo size (default 10GB):
<span class="notesCode">    $ ipfs config Datastore.StorageMax 50MB</span>

Create a service to make sure IPFS is running all the time:
<span class="notesCode">    $ sudo vi /etc/systemd/system/ipfs.service</span>
<span class="notesCode">    &gt; [Unit]</span>
<span class="notesCode">    &gt; Description=IPFS Daemon</span>
<span class="notesCode">    &gt; [Service]</span>
<span class="notesCode">    &gt; Type=simple</span>
<span class="notesCode">    &gt; ExecStart=/home/cvidon/go/bin/ipfs daemon --enable-gc</span>
<span class="notesCode">    &gt; Group=cvidon</span>
<span class="notesCode">    &gt; Restart=always</span>
<span class="notesCode">    &gt; Environment=&quot;IPFS_PATH=/home/cvidon/.ipfs&quot;</span>
<span class="notesCode">    &gt; [Install]</span>
<span class="notesCode">    &gt; WantedBy=multi-user.target</span>

Start and enable IPFS service:
<span class="notesCode">    $ sudo systemctl daemon-reload</span>
<span class="notesCode">    $ sudo systemctl enable ipfs</span>
<span class="notesCode">    $ sudo systemctl start ipfs</span>
Check that IPFS is active and enabled:
<span class="notesCode">    $ sudo systemctl status ipfs</span>

Set a firewall exceptions to port 4001:
<span class="notesCode">    $ sudo ufw allow 4001/tcp</span>
Check firewall exceptions:
<span class="notesCode">    $ sudo ufw status</span>

Port forwarding:
MyVM -&gt;<span class="notesCode">Settings</span> -&gt;<span class="notesCode">Network</span>
 Attached to: <span class="notesCode">NAT</span>
 -&gt;<span class="notesCode">Advanced</span> -&gt;<span class="notesCode">Port Forwarding</span>
 -&gt;(+) Name:<span class="notesCode">IPFS</span>| Host Port:<span class="notesCode">4001</span>| Guest Port:<span class="notesCode">4001</span>

Check port 4001 tcp connection:
<span class="notesCode">    $ sudo ss -nat | grep 4001</span>

<span class="notesUrl"><a href="https://docs.ipfs.io/how-to/observe-peers/">https://docs.ipfs.io/how-to/observe-peers/</a></span>
See whose peer we are directly connected to:
<span class="notesCode">    $ ipfs swarm peers</span>
Print bandwidth information.
<span class="notesCode">    $ ipfs stats bw</span>
</pre>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
